var M=Object.defineProperty,V=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var b=(n,e,s)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s,k=(n,e)=>{for(var s in e||(e={}))B.call(e,s)&&b(n,s,e[s]);if(A)for(var s of A(e))L.call(e,s)&&b(n,s,e[s]);return n},_=(n,e)=>V(n,N(e));import{_ as C,d as $,r as m,o as i,g as a,a as t,e as j,i as l,b as r,l as g,m as f,t as u,w as p,n as w,F as P,f as c,c as F}from"./main.ff91f6f2.js";const x={class:"p-6 bg-white shadow mt-4 prose max-w-none"},D=t("h3",null,"Create API Token",-1),S=t("p",null,"API tokens allow third-party services to authenticate with our application on your behalf.",-1),U={class:"col-span-6 sm:col-span-4"},q={key:0,class:"col-span-6"},z={class:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-4"},E={class:"flex items-center"},Y={class:"ml-2 text-sm text-gray-600"},G=t("span",{class:"material-icons-outlined"}," save_as ",-1),H={key:0,class:"p-6 bg-white shadow mt-4 prose max-w-none"},J={class:"mt-10 sm:mt-0"},K=t("h3",null,"Manage API Tokens",-1),O=t("p",null,"You may delete any of your existing tokens if they are no longer needed.",-1),Q={class:"space-y-6"},R={class:"flex items-center"},W={key:0,class:"text-sm text-gray-400"},X=["onClick"],Z=["onClick"],ee=c(" API Token "),se=t("div",null," Please copy your new API token. For your security, it won't be shown again. ",-1),oe={key:0,class:"mt-4 bg-gray-100 px-4 py-2 rounded font-mono text-sm text-gray-500"},te=c(" Close "),ne=c(" API Token Permissions "),ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"flex items-center"},re={class:"ml-2 text-sm text-gray-600"},le=c(" Cancel "),pe=c(" Save "),me={data(){return{createApiTokenForm:{name:"",permissions:this.store.props.defaultPermissions},updateApiTokenForm:{permissions:[]},displayingToken:!1,managingPermissionsFor:null,photoPreview:null}},methods:{async createApiToken(){try{await this.store.axios.post("/phmoney/user/api-tokens",this.createApiTokenForm)}catch{}await this.store.get("/phmoney/user/api-tokens"),this.displayingToken=!0,this.createApiTokenForm={name:"",permissions:this.store.props.defaultPermissions}},manageApiTokenPermissions(n){this.updateApiTokenForm.permissions=n.abilities,this.managingPermissionsFor=n},async updateApiToken(){try{await this.store.axios.put(`/phmoney/user/api-tokens/${this.managingPermissionsFor.id}`,this.updateApiTokenForm)}catch{}await this.store.get("/phmoney/user/api-tokens"),this.managingPermissionsFor=null},async deleteApiToken(n){if(confirm("Are you sure you want to delete this item?")){try{await this.store.axios.delete(`/phmoney/user/api-tokens/${n}`,{})}catch{}await this.store.get("/phmoney/user/api-tokens")}}}},de=$(_(k({},me),{name:"ApiTokenManager",setup(n){return(e,s)=>{const h=m("form-label"),I=m("form-input"),y=m("form-checkbox"),v=m("form-button"),T=m("form-secondary-button");return i(),a("div",null,[t("div",x,[D,S,t("form",{onSubmit:s[2]||(s[2]=j((...o)=>e.createApiToken&&e.createApiToken(...o),["prevent"]))},[l(" Token Name "),t("div",U,[r(h,{for:"name",value:"Name"}),r(I,{id:"name",type:"text",class:"mt-1 block w-full",modelValue:e.createApiTokenForm.name,"onUpdate:modelValue":s[0]||(s[0]=o=>e.createApiTokenForm.name=o),required:"",autofocus:""},null,8,["modelValue"])]),l(" Token Permissions "),e.store.props.availablePermissions&&e.store.props.availablePermissions.length>0?(i(),a("div",q,[r(h,{for:"permissions",value:"Permissions"}),t("div",z,[(i(!0),a(g,null,f(e.store.props.availablePermissions,o=>(i(),a("div",{key:o},[t("label",E,[r(y,{value:o,checked:e.createApiTokenForm.permissions,"onUpdate:checked":s[1]||(s[1]=d=>e.createApiTokenForm.permissions=d)},null,8,["value","checked"]),t("span",Y,u(o),1)])]))),128))])])):l("v-if",!0),r(v,{class:w(["mt-4",{"opacity-25":e.store.processing}]),disabled:e.store.processing,title:"Create"},{default:p(()=>[G]),_:1},8,["class","disabled"])],32)]),e.store.props.tokens&&e.store.props.tokens.length>0?(i(),a("div",H,[l(" Manage API Tokens "),t("div",J,[K,O,t("div",Q,[(i(!0),a(g,null,f(e.store.props.tokens,o=>(i(),a("div",{class:"flex items-center justify-between border-b",key:o.id},[t("div",null,u(o.name),1),t("div",R,[o.last_used_ago?(i(),a("div",W," Last used "+u(o.last_used_ago),1)):l("v-if",!0),e.store.props.availablePermissions.length>0?(i(),a("button",{key:1,class:"cursor-pointer ml-6 text-sm text-gray-400 underline",onClick:d=>e.manageApiTokenPermissions(o)}," Permissions ",8,X)):l("v-if",!0),t("button",{class:"cursor-pointer ml-6 text-sm text-red-500",onClick:d=>e.deleteApiToken(o.id)}," Delete ",8,Z)])]))),128))])])])):l("v-if",!0),l(" Token Value Modal "),r(P,{show:e.displayingToken,onClose:s[4]||(s[4]=o=>e.displayingToken=!1)},{title:p(()=>[ee]),content:p(()=>[se,e.store.props.jetstream.flash.token?(i(),a("div",oe,u(e.store.props.jetstream.flash.token),1)):l("v-if",!0)]),footer:p(()=>[r(T,{onClick:s[3]||(s[3]=o=>e.displayingToken=!1)},{default:p(()=>[te]),_:1})]),_:1},8,["show"]),l(" API Token Permissions Modal "),r(P,{show:e.managingPermissionsFor,onClose:s[7]||(s[7]=o=>e.managingPermissionsFor=null)},{title:p(()=>[ne]),content:p(()=>[t("div",ie,[(i(!0),a(g,null,f(e.store.props.availablePermissions,o=>(i(),a("div",{key:o},[t("label",ae,[r(y,{value:o,checked:e.updateApiTokenForm.permissions,"onUpdate:checked":s[5]||(s[5]=d=>e.updateApiTokenForm.permissions=d)},null,8,["value","checked"]),t("span",re,u(o),1)])]))),128))])]),footer:p(()=>[r(T,{onClick:s[6]||(s[6]=o=>e.managingPermissionsFor=null)},{default:p(()=>[le]),_:1}),r(v,{class:w(["ml-2",{"opacity-25":e.store.processing}]),onClick:e.updateApiToken,disabled:e.store.processing},{default:p(()=>[pe]),_:1},8,["onClick","class","disabled"])]),_:1},8,["show"])])}}}));var ue=C(de,[["__file","/home/phalo/kainotomo/web_gnucash/vue/code/src/components/api/ApiTokenManager.vue"]]);const ce={async created(){await this.store.get("/phmoney/user/api-tokens")}},he=$(_(k({},ce),{name:"ApiIndex",setup(n){return(e,s)=>{const h=m("FormLayout");return i(),F(h,{title:"API Tokens"},{default:p(()=>[e.store.processing?l("v-if",!0):(i(),F(ue,{key:0}))]),_:1})}}}));var ge=C(he,[["__file","/home/phalo/kainotomo/web_gnucash/vue/code/src/views/api/ApiIndex.vue"]]);export{ge as default};
